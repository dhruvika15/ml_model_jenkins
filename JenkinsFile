pipeline {
  agent any
  /*environment {
    AZURE_SUBSCRIPTION_ID='99999999-9999-9999-9999-999999999999'
    AZURE_TENANT_ID='99999999-9999-9999-9999-999999999999'
    AZURE_STORAGE_ACCOUNT='myStorageAccount'
  }*/
  stages {
    stage('Build') {
      steps {
          /*withCredentials([usernamePassword(credentialsId: 'azuresp', 
                        passwordVariable: 'AZURE_CLIENT_SECRET', 
                        usernameVariable: 'AZURE_CLIENT_ID')]) {
          sh '''
            # Login to Azure with ServicePrincipal
            az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID
            # Set default subscription
            az account set --subscription $AZURE_SUBSCRIPTION_ID
            # Execute download to Azure
            az storage blob download --account-name $AZURE_STORAGE_ACCOUNT --container-name myjob --name hello.txt --file ${WORKSPACE}/hello.txt --auth-mode login
            # Logout from Azure
            az logout
          '''   */
          sh '''
            echo HI
            sudo cp -r * /ml_jenkins
            cd /ml_jenkins
            sudo docker build -t ml_model:v1 .
            sudo docker rm c1
            sudo docker run --name c1 ml_model:v1
            sudo docker cp c1:/dogcat.h5 /ml_jenkins
          '''   
        }
      }
    }
  }
